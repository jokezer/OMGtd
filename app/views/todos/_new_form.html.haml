= bootstrap_form_for(@todo, style: :horizontal, left: 'col-lg-2', right: 'col-lg-8') do |f|
  = f.text_field :title
  = f.text_area :content, hide_label: :true, placeholder: 'Todo description...'
  = f.select :kind, get_kinds,
  selected: action_name=='new' ? params[:from_kind] : @todo.kind
  = f.select :prior_id, TodoPrior::COLLECTION.invert, :prompt => 'Prior...'
  - array = current_user.contexts.map { |context| [context.label, context.id] }
  -if array.empty?
    = f.form_group do
      There is no contexts
      = link_to('Create contexts', contexts_path)
  -else
    = f.select :context_id, array, prompt: 'Context...',
     selected: action_name=='new' ? params[:from_context] : @todo.context_id
  - array = current_user.projects.with_state(:active).map{ |project| [project.label, project.id] }
  = f.select :project_id, array, prompt: 'Project...',
  selected: (action_name=='new' ? params[:from_project]:@todo.project_id) if array.any?
  = f.form_group(:todo, label: {text: 'Deadline'}) do
    = check_box(:todo, :is_deadline, {checked: @todo.expire ? true : false})
    = datetime_select(:todo, :expire, :default => 24.hours.from_now, :minute_step => 10)
    = @todo.errors[:is_deadline]
  = f.form_group do
    = f.submit button_title, class: 'btn btn-primary'
    - unless @todo.project
      = f.submit button_title, value:'Make project', name:'make_project', class: 'btn btn-link pull-right',
        data: { confirm: 'Are you sure want to make project from this todo?'}
    -if @todo.can_activate? and action_name == 'show'
      = f.submit 'Activate', name: 'activate', class: 'btn btn-primary',
        data: { confirm: "Are you sure want to activate this todo?"}
    -if @todo.can_complete? and action_name == 'show'
      = f.submit 'Complete', name: 'complete', class: 'btn btn-primary',
        data: { confirm: "Are you sure want to complete this todo?"}
    -if @todo.can_cancel? and action_name == 'show'
      = f.submit 'Cancel', name: 'cancel', class: 'btn btn-primary',
        data: { confirm: "Are you sure want to cancel this todo?"}
    - if @todo.can_delete? and action_name == 'show'
      = link_to 'Delete', @todo, method: :delete, class: 'btn',
        data: { confirm: 'Are you sure want to delete this todo?'}
  =debug(@todo)